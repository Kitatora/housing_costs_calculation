{% extends "app/base.html" %}
{% load widget_tweaks %}

{% block content %}

<div class="h5 mt-5">総額計算</div>
  <p id="tabcontrol">
    <a href="#tabpage1" class="present">物件1</a>
    <a href="#tabpage2">物件2</a>
    <a href="#tabpage3">物件3</a>
  </p>
  <div id="tabbody">
    <!-- タブ1 -->
    <!-- 持ち家用 -->
    <div id="tabpage1">
      <form method="post">
        <table class="container" border="2" width="200px">
          {% csrf_token %}
          <tbody>
            <tr>
              <th scope="row" class="title-bg-1 text-center">契約タイプ</th>
              <td class="formpost">
                <label class="ml-4 mr-5 my-3"><input type="radio" name="contract">持ち家</label>
                <label class="ml-4 mr-5 my-3"><input type="radio" name="contract">賃貸</label>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-1 text-center">物件タイプ</th>
              <td class="formpost">
                <label class="ml-4 mr-5 my-3"><input type="radio" name="housing">戸建て</label>
                <label class="ml-4 mr-5 my-3"><input type="radio" name="housing">マンション</label>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-1 text-center">各種費用</th>
              <td class="data ml-4 mr-5 my-3">
                <p>物件価格（円）
                  {% render_field form.price class="form-control" placeholder="物件価格" %}
                </p>
                <p>修繕積立（円/月）
                  {% render_field form.RRF class="form-control disabled" placeholder="修繕積立" %}
                </p>
                <p>管理費（円/月）
                  {% render_field form.MMF class="form-control disabled" placeholder="管理費" %}
                </p>
                <p>その他（円/月）
                  {% render_field form.OMF class="form-control disabled" placeholder="その他" %}
                </p>
                </div>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-1 text-center">ローン借入</th>
              <td class="formpost">
                <label class="ml-4 mr-5 my-3"><input type="radio" name="loan">有</label>
                <label class="ml-4 mr-5 my-3"><input type="radio" name="loan">無</label><br>
                借入金（円）　{% render_field form.loan class="form-control" placeholder="ローン借入額" %}<br>
                年利（％）　　{% render_field form.interest class="form-control" placeholder="年利" %}<br>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-1 text-center">頭金</th>
              <td class="ml-4 mr-5 my-3 formpost">
                頭金（円）　　{% render_field form.down class="form-control" placeholder="頭金" %}
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-1 text-center">返済期間</th>
              <td class="ml-4 mr-5 my-3 formpost">
                返済期間（年）　{% render_field form.term class="form-control" placeholder="返済期間" %}
              </td>
            </tr>
          </tbody>
        </table>
        <p class="text-center mt-3">
          <button type="submit" class="btn btn-info mt-3 mb-5" id="simulation">シミュレーション実行</button>
        </p>
      </form>
    </div>

    <!-- タブ2情報 -->
    <div id="tabpage2">
      <form method="post">
        <tbody id="f_own">
            <tr>
              <th scope="row" class="title-bg-2 text-center">契約タイプ</th>
              <td class="formpost">
                <label class="ml-4 mr-5 my-3"><input type="radio" name="contract">持ち家</label>
                <label class="ml-4 mr-5 my-3"><input type="radio" name="contract">賃貸</label>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-2 text-center">物件タイプ</th>
              <td class="formpost">
                <label class="ml-4 mr-5 my-3"><input type="radio" name="housing">戸建て</label>
                <label class="ml-4 mr-5 my-3"><input type="radio" name="housing">マンション</label>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-2 text-center">各種費用</th>
              <td class="data ml-4 mr-5 my-3">
                <p>物件価格（円）
                  {% render_field form.price class="form-control" placeholder="物件価格" %}
                </p>
                <div class="formpost" type="text">
                </div>
                <p>修繕積立（円/月）
                  {% render_field form.RRF class="form-control disabled" placeholder="修繕積立" %}
                </p>
                <p>管理費（円/月）
                  {% render_field form.MMF class="form-control disabled" placeholder="管理費" %}
                </p>
                <p>その他（円/月）
                  {% render_field form.OMF class="form-control disabled" placeholder="その他" %}
                </p>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-2 text-center">ローン借入</th>
              <td class="formpost">
                <label class="ml-4 mr-5 my-3"><input type="radio" name="loan">有</label>
                <label class="ml-4 mr-5 my-3"><input type="radio" name="loan">無</label><br>
                借入金（円）　{% render_field form.loan class="form-control" placeholder="ローン借入額" %}<br>
                年利（％）　　{% render_field form.interest class="form-control" placeholder="年利" %}<br>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-2 text-center">頭金</th>
              <td class="ml-4 mr-5 my-3 formpost">
                頭金（円）　　{% render_field form.down class="form-control" placeholder="頭金" %}</td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-2 text-center">返済期間</th>
              <td class="ml-4 mr-5 my-3 formpost">
                返済期間（年）　{% render_field form.term class="form-control" placeholder="返済期間" %}</td>
            </tr>
          </tbody>
        </table>
        <p class="text-center mt-3">
          <button type="submit" class="btn btn-info mt-3 mb-5" id="simulation">シミュレーション実行</button>
        </p>
      </form>
    </div>

    <!-- タグ3 -->
    <div id="tabpage3">
      <form method="post">
        <table class="container" border="2" width="200px">
          {% csrf_token %}
          <tbody>
            <tr>
              <th scope="row" class="title-bg-3 text-center">契約タイプ</th>
              <td class="formpost">
                <label class="ml-4 mr-5 my-3"><input type="radio" name="contract">持ち家</label>
                <label class="ml-4 mr-5 my-3"><input type="radio" name="contract">賃貸</label>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-3 text-center">物件タイプ</th>
              <td class="formpost">
                <label class="ml-4 mr-5 my-3"><input type="radio" name="housing">戸建て</label>
                <label class="ml-4 mr-5 my-3"><input type="radio" name="housing">マンション</label>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-3 text-center">各種費用</th>
              <td class="data ml-4 mr-5 my-3">
                <p>物件価格（円）
                  {% render_field form.price class="form-control" placeholder="物件価格" %}
                </p>
                <p>修繕積立（円/月）
                  {% render_field form.RRF class="form-control disabled" placeholder="修繕積立" %}</div>
                </p>
                <p>管理費（円/月）
                  {% render_field form.MMF class="form-control disabled" placeholder="管理費" %}
                </p>
                <p>その他（円/月）
                  {% render_field form.OMF class="form-control disabled" placeholder="その他" %}
                </p>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-3 text-center">ローン借入</th>
              <td class="formpost">
                <label class="ml-4 mr-5 my-3"><input type="radio" name="loan">有</label>
                <label class="ml-4 mr-5 my-3"><input type="radio" name="loan">無</label><br>
                借入金（円）　{% render_field form.loan class="form-control" placeholder="ローン借入額" %}<br>
                年利（％）　　{% render_field form.interest class="form-control" placeholder="年利" %}<br>
              </td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-3 text-center">頭金</th>
              <td class="ml-4 mr-5 my-3 formpost">
                頭金（円）　　{% render_field form.down class="form-control" placeholder="頭金" %}</td>
            </tr>
            <tr>
              <th scope="row" class="title-bg-3 text-center">返済期間</th>
              <td class="ml-4 mr-5 my-3 formpost">
                返済期間（年）　{% render_field form.term class="form-control" placeholder="返済期間" %}</td>
            </tr>
          </tbody>
        </table>
        <p class="text-center mt-3">
          <button type="submit" class="btn btn-info mt-3 mb-5" id="simulation">シミュレーション実行</button>
        </p>
      </form>
    </div>
  </div>

<div class="h5 mt-5">総額内訳</div>
<section>
  <table class="container text-center price-table" border="2">
    <tbody>
      <tr class="bg-warning">
        <th scope="row" rowspan="2"></th>
        <th scope="row" colspan="4">各種物件費用</th>
        <th scope="row" rowspan="2">ローン利息</th>
        <th scope="row" rowspan="2">消費税</th>
        <th scope="row" rowspan="2">購入初期費</th>
        <th scope="row" rowspan="2">ローン初期費</th>
        <th scope="row" rowspan="2">固定資産税</th>
        <th scope="row" rowspan="2">総額</th>
    </tr>
    <tr class="bg-warning">
      <th scope="row mx-4 my-4">物件価格</th>
      <th scope="row">修繕積立</th>
      <th scope="row">管理費</th>
      <th scope="row">その他</th>
    </tr>
    <tr class="mx-4 my-4">
      <th scope="row">物件1</th>
      <td class="mx-4 my-4">{{ total_price }}</td>
      <td class="mx-4 my-4">{{ total_RRF }}</td>
      <td class="mx-4 my-4">{{ total_MMF }}</td>
      <td class="mx-4 my-4">{{ total_OMF }}</td>
      <td class="mx-4 my-4">{{ total_interest }}</td>
      <td class="mx-4 my-4">{{ vat }}</td>
      <td class="mx-4 my-4">{{ miscellaneous }}</td>
      <td class="mx-4 my-4">{{ miscellaneous_if_loan }}</td>
      <td class="mx-4 my-4">{{ property_tax }}</td>
      <td class="mx-4 my-4">{{ grand_total }}</td>
    </tr>
    <tr>
      <th scope="row">物件2</th>
      <td class="mx-4 my-4">{{ total_price }}</td>
      <td class="mx-4 my-4">{{ total_RRF }}</td>
      <td class="mx-4 my-4">{{ total_MMF }}</td>
      <td class="mx-4 my-4">{{ total_OMF }}</td>
      <td class="mx-4 my-4">{{ total_interest }}</td>
      <td class="mx-4 my-4">{{ vat }}</td>
      <td class="mx-4 my-4">{{ miscellaneous }}</td>
      <td class="mx-4 my-4">{{ miscellaneous_if_loan }}</td>
      <td class="mx-4 my-4">{{ property_tax }}</td>
      <td class="mx-4 my-4">{{ grand_total }}</td>
    </tr>
    <tr>
      <th scope="row">物件3</th>
      <td class="mx-4 my-4">{{ total_price }}</td>
      <td class="mx-4 my-4">{{ total_RRF }}</td>
      <td class="mx-4 my-4">{{ total_MMF }}</td>
      <td class="mx-4 my-4">{{ total_OMF }}</td>
      <td class="mx-4 my-4">{{ total_interest }}</td>
      <td class="mx-4 my-4">{{ vat }}</td>
      <td class="mx-4 my-4">{{ miscellaneous }}</td>
      <td class="mx-4 my-4">{{ miscellaneous_if_loan }}</td>
      <td class="mx-4 my-4">{{ property_tax }}</td>
      <td class="mx-4 my-4">{{ grand_total }}</td>
    </tr>
    </tbody>
  </table>
</section>

<div class="h5 mt-5">支払い金額推移</div>
<div class="form-row text-center">
  <div class="col-12 text-center mt-3">
    <canvas id="myLineChart"></canvas>
    <button type="button" class="btn btn-info mt-3 mb-5">シミュレーション結果を保存</button>
  </div>
</div>

<label>
  <input class="js-check" type="radio" name="rs" value="1" onclick="formSwitch()" >特にない
</label>

<label>
  <input class="js-check" type="radio" name="rs" value="1" onclick="formSwitch()">好きな音楽のジャンル
</label>

<span id="sample">
  
<div class="selecter">
  <select id="changeSelect" name="hoge" onchange="entryChange2();">
    <option value="select1">ジャンルを選んでください</option>
    <option value="select2">ロック</option>
    <option value="select3">ジャズ</option>
    <option value="select4">ポップス</option>
    <option value="select5">クラシック</option>
    <option value="select6">ラテン</option>
   </select>
</div>
  
</span>

<div id="Box">
  <p>『ロック』の発祥は1950年代と言われています。アメリカに奴隷として連れてこられた黒人たちのアフリカ系黒人音楽が起源らしいです。</p>
</div>

<div id="Box2">
  <p>『ジャズ』は、19世紀末から20世紀初頭にかけて、アメリカのニューオリーンズで西洋楽器を用いたヨーロッパ音楽の技術と独特なリズムの黒人音楽が融合したことにより生まれたとされます。</p>
</div>

<div id="Box3">
  <p>『ポップス』は1950〜60年代に西洋でロックの派生として現代的形態で始まったポピュラー音楽です。</p>
</div>

<div id="Box4">
  <p>『クラシック』の語源はラテン語のクラスにあり、直訳すると「古典音楽」です。一流・最高という意味もあります。</p>
</div>

<div id="Box5">
  <p>『ラテン』は、中南米発祥の音楽の総称で中南米とカリブ海地域のラテン系の民族音楽のことを言います。</p>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
<script>
  var ctx = document.getElementById("myLineChart");
  console.log("Hello World")
  // var p_li_js = '({{ total_price }})';
  var p_li = '{{ p_li }}';
  console.log(p_li)
  p_li = p_li.split(',')
  console.log(p_li)
  var t_li = '{{ t_li }}';
  console.log(t_li)
  t_li = t_li.split(',')
  console.log(t_li)
  var myLineChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: t_li,
      datasets: [
        {
          label: '支払い総額',
          // data: [35000000, 40000000, 70000000, 50000000, 75000000],
          data: p_li,
          borderColor: "rgba(255,0,0,1)",
          backgroundColor: "rgba(0,0,0,0)"
        },
        {
          label: '最低気温（度）',
          data: ['25000000', '27000000', '27000000', '25000000', '26000000'],
          borderColor: "rgba(0,0,255,1)",
          backgroundColor: "rgba(0,0,0,0)"
        }
      ],
    },
    options: {
      title: {
        display: true,
        text: '気温（8月1日~8月7日）'
      },
      scales: {
        yAxes: [{
          ticks: {
            suggestedMax: 100000000,
            suggestedMin: 0,
            stepSize: 10000000,
            callback: function (value, index, values) {
              return value + '円'
            }
          }
        }]
      },
    }
  });

  // タブの切り替える
  // A.対象要素を得る
  var tabs = document.getElementById('tabcontrol').getElementsByTagName('a');
  var pages = document.getElementById('tabbody').getElementsByTagName('div');
  // B.タブの切り替え処理
  function changeTab() {
    var targetid = this.href.substring(this.href.indexOf('#')+1,this.href.length); // ▼B-1. href属性値から対象のid名を抜き出す
    for(var i=0; i<pages.length; i++) {      // ▼B-2. 指定のタブページだけを表示する
        if( pages[i].id != targetid ) {
          pages[i].style.display = "none";
        }
        else {
          pages[i].style.display = "block";
        }
    }
    for(var i=0; i<tabs.length; i++) {    // ▼B-3. クリックされたタブを前面に表示する
        tabs[i].style.zIndex = "0";
    }
    this.style.zIndex = "10";
    return false;    // ▼B-4. ページ遷移しないようにfalseを返す
  }

  for(var i=0; i<tabs.length; i++) {   // C.全てのタブに対して、クリック時にchangeTab関数が実行される
    tabs[i].onclick = changeTab;
  }
  tabs[0].onclick();  

  // ラジオボタンを使ったフォームの切り替え
var selecterBox = document.getElementById('sample');
var selecter = document.getElementById('changeSelect');
var item1 = document.getElementById('Box'); //Box：セレクタの説明文
var item2 = document.getElementById('Box2');
var item3 = document.getElementById('Box3');
var item4 = document.getElementById('Box4');
var item5 = document.getElementById('Box5');
selecterBox.style.display = "none"; 
item2.style.display = "none";
item3.style.display = "none";
item4.style.display = "none";
item5.style.display = "none";
item1.style.display = "none";
//要素.style.display='none'で'その要素が非表示になる。
//つまり、selectorBoxになにも選択されていない場合、selectorBoxには何も表示されない
// document.getElementByIdのgetは、getElementByIdを使うのに必要な提携文と覚えて差し支えは無い

function formSwitch() {
  check = document.getElementsByClassName('js-check')
  if (check[0].checked) {
    selecterBox.style.display = "none";
    item1.style.display = "none";
    item2.style.display = "none";
    item3.style.display = "none";
    item4.style.display = "none";
    item5.style.display = "none";
    selecter.selectedIndex = 0;
  // .checkedプロパティ。チェックボックスがチェックされていればTrueを返し、されていなければfalseを返す。
  // getElementsBy系のメソッドは、idがhtml中に複数存在する場合、全ての要素をリストに格納する。
  // つまり、check[0]とは「特に無い」ラジオボックスのことで、check[1]は「好きな音楽のジャンル」
  // 上記は「特にない」を選択していた場合、全てのitemで非表示を選択するということ
  } else if (check[1].checked) {
    selecterBox.style.display = "block";
  } else {
    selecterBox.style.display = "none";
    // 何も選択されていなければ非表示
  } 
}
window.addEventListener('load', formSwitch());

function entryChange2(){
  if(document.getElementById('changeSelect')){
  id = document.getElementById('changeSelect').value;

  if(id == 'select2'){
    item1.style.display = "block";
    item2.style.display = "none";
    item3.style.display = "none";
    item4.style.display = "none";
    item5.style.display = "none";
  }
  else if(id == 'select3'){
    item1.style.display = "none";
    item2.style.display = "block";
    item3.style.display = "none";
    item4.style.display = "none";
    item5.style.display = "none";
  }
  else if(id == 'select4'){
    item1.style.display = "none";
    item2.style.display = "none";
    item3.style.display = "block";
    item4.style.display = "none";
    item5.style.display = "none";
  }
  else if(id == 'select5'){
    item1.style.display = "none";
    item2.style.display = "none";
    item3.style.display = "none";
    item4.style.display = "block";
    item5.style.display = "none";
  }
    else if(id == 'select6'){
    item1.style.display = "none";
    item2.style.display = "none";
    item3.style.display = "none";
    item4.style.display = "none";
    item5.style.display = "block";
  }
  else{
    item1.style.display = "none";
    item2.style.display = "none";
    item3.style.display = "none";
    item4.style.display = "none";
    item5.style.display = "none";
  }
}
}


</script>
{%  endblock %}